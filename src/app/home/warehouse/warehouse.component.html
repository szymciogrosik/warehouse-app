@let warehouses = (warehouses$ | async);

<mat-card class="warehouse-card">

  <!-- Nav bar -->
  <div class="nav-header">
    <div class="nav-left">
      @if (viewLevel > 0) {
        <button mat-icon-button (click)="goBack()">
          <mat-icon class="mat-icon-class">arrow_back</mat-icon>
        </button>
      }
      <span class="nav-title">
      {{ getNavTitle() }}
    </span>
    </div>

    <div class="nav-right">
      @if (viewLevel > 0) {
        <button mat-icon-button (click)="remove()">
          <mat-icon class="mat-icon-class">delete</mat-icon>
        </button>
        <button mat-icon-button (click)="edit()">
          <mat-icon class="mat-icon-class">edit</mat-icon>
        </button>
      }
      <button mat-icon-button (click)="add()">
        <mat-icon class="mat-icon-class">add_circle</mat-icon>
      </button>
    </div>
  </div>

  @if (warehouses && warehouses.warehouses.length > 0) {

    <!-- Warehouses list -->
    @if (viewLevel === 0) {
      <div class="tile-list warehouses">
        @for (w of warehouses.warehouses; track $index) {
          <div class="tile">
            <mat-card class="tile-card" (click)="enterWarehouse($index)">
              <mat-card-title class="card-title-class">{{ w.name }}</mat-card-title>
              <mat-card-subtitle class="subtitle-dates">
                {{ 'wh.element.lastModificationTimestamp' | translate }}{{ this.presentTimestamp(this.getLastModificationTimestampForWarehouse(w)) }}
              </mat-card-subtitle>
              <mat-card-subtitle class="subtitle-dates">
                {{ 'wh.element.createdTimestamp' | translate }}{{ this.presentTimestamp(w.createdTimestamp) }}
              </mat-card-subtitle>
              <mat-card-content class="subtitle-description">
                {{ w.description }}
              </mat-card-content>
            </mat-card>
          </div>
        }
      </div>
    }

    <!-- Rooms -->
    @if (viewLevel === 1 && selectedWarehouseIndex !== null) {
      @let warehouse = warehouses.warehouses[selectedWarehouseIndex];
      <div class="tile-list rooms">
        @for (room of warehouse.rooms; track $index) {
          <div class="tile">
            <mat-card class="tile-card" (click)="enterRoom($index)">
              <mat-card-title class="card-title-class">{{ room.name }}</mat-card-title>
              <mat-card-subtitle class="subtitle-dates">
                {{ 'wh.element.lastModificationTimestamp' | translate }}{{ this.presentTimestamp(this.getLastModificationTimestampForRoom(room)) }}
              </mat-card-subtitle>
              <mat-card-subtitle class="subtitle-dates">
                {{ 'wh.element.createdTimestamp' | translate }}{{ this.presentTimestamp(room.createdTimestamp) }}
              </mat-card-subtitle>
              <mat-card-content class="subtitle-description">
                {{ room.description }}
              </mat-card-content>
            </mat-card>
          </div>
        }
      </div>
    }

    <!-- Boxes -->
    @if (viewLevel === 2 && selectedWarehouseIndex !== null && selectedRoomIndex !== null) {
      @let warehouse = warehouses.warehouses[selectedWarehouseIndex];
      <mat-list>
        @for (box of warehouse.rooms[selectedRoomIndex].boxes; track $index) {
          <mat-list-item class="tile-box list-item-class" (click)="enterBox($index)">
            <!-- Title + actions on the same row -->
            <div matListItemTitle class="list-item-header">
              <div class="list-item-title">
                <mat-icon class="mat-icon-in-list-header-class">inventory_2</mat-icon>
                {{ box.name }}
              </div>
            </div>

            <!-- Optional description -->
            <span matListItemLine class="list-item-description">
              <mat-icon class="mat-icon-in-list-class">category</mat-icon>
              @if (box.description) {
                {{ box.description }}
              } @else {
                -
              }
            </span>

            <!-- Timestamps -->
            <span matListItemLine class="list-item-timestamps">
                {{ 'wh.element.lastModificationTimestamp' | translate }}
              {{ this.presentTimestamp(this.getLastModificationTimestampForBox(box)) }}
            </span>
            <span matListItemLine class="list-item-timestamps">
                {{ 'wh.element.createdTimestamp' | translate }}
              {{ this.presentTimestamp(box.createdTimestamp) }}
            </span>
          </mat-list-item>
        }
      </mat-list>
    }

    <!-- Items -->
    @if (viewLevel === 3
    && selectedWarehouseIndex !== null
    && selectedRoomIndex !== null
    && selectedBoxIndex !== null) {
      @let warehouse = warehouses.warehouses[selectedWarehouseIndex];
      <mat-list>
        @for (item of warehouse.rooms[selectedRoomIndex].boxes[selectedBoxIndex].items; track $index) {
          <mat-list-item class="list-item-class">
            <!-- Title + actions on the same row -->
            <div matListItemTitle class="list-item-header">
              <div class="list-item-title">
                <mat-icon class="mat-icon-in-list-header-class">sell</mat-icon>
                {{ item.name }}
              </div>
              <div class="list-item-actions">
                <button mat-icon-button (click)="editItem($index)">
                  <mat-icon>edit</mat-icon>
                </button>
                <button mat-icon-button (click)="removeItem($index)">
                  <mat-icon>delete</mat-icon>
                </button>
              </div>
            </div>

            <!-- Optional description -->
            <span matListItemLine class="list-item-description">
              <mat-icon class="mat-icon-in-list-class">category</mat-icon>
              @if (item.description) {
                {{ item.description }}
              } @else {
                -
              }
            </span>

            <!-- Timestamps -->
            <span matListItemLine class="list-item-timestamps">
              {{ 'wh.element.lastModificationTimestamp' | translate }}
              {{ this.presentTimestamp(item.updatedTimestamp) }}
            </span>
            <span matListItemLine class="list-item-timestamps">
              {{ 'wh.element.createdTimestamp' | translate }}
              {{ this.presentTimestamp(item.createdTimestamp) }}
            </span>
          </mat-list-item>
        }
      </mat-list>
    }
  }
</mat-card>
