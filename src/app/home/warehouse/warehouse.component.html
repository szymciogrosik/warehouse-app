@let warehouses = (warehouses$ | async);

<mat-card class="warehouse-card">

  <!-- Nav bar -->
  <div class="nav-header">
    <div class="nav-left">
      @if (viewLevel > 0) {
        <button mat-icon-button (click)="goBack()">
          <mat-icon class="mat-icon-class">arrow_back</mat-icon>
        </button>
      }
      <span class="nav-title">
      {{ getNavTitle() }}
    </span>
    </div>

    <div class="nav-right">
      @if (viewLevel > 0) {
        <button mat-icon-button (click)="remove()">
          <mat-icon class="mat-icon-class">delete</mat-icon>
        </button>
        <button mat-icon-button (click)="edit()">
          <mat-icon class="mat-icon-class">edit</mat-icon>
        </button>
      }
      <button mat-icon-button (click)="add()">
        <mat-icon class="mat-icon-class">add_circle</mat-icon>
      </button>
    </div>
  </div>

  @if (warehouses && warehouses.warehouses.length > 0) {

    <!-- Warehouses list -->
    @if (viewLevel === 0) {
      <div class="tile-list warehouses">
        @for (w of warehouses.warehouses; track $index) {
          <div class="tile">
            <mat-card class="tile-card" (click)="enterWarehouse($index)">
              <mat-card-title>{{ w.name }}</mat-card-title>
              <mat-card-subtitle>{{ w.description }}</mat-card-subtitle>
            </mat-card>
          </div>
        }
      </div>
    }

    <!-- Rooms -->
    @if (viewLevel === 1 && selectedWarehouseIndex !== null) {
      @let warehouse = warehouses.warehouses[selectedWarehouseIndex];
      <div class="tile-list rooms">
        @for (room of warehouse.rooms; track $index) {
          <div class="tile">
            <mat-card class="tile-card" (click)="enterRoom($index)">
              <mat-card-title>{{ room.name }}</mat-card-title>
              <mat-card-subtitle>{{ room.description }}</mat-card-subtitle>
            </mat-card>
          </div>
        }
      </div>
    }

    <!-- Boxes -->
    @if (viewLevel === 2 && selectedWarehouseIndex !== null && selectedRoomIndex !== null) {
      @let warehouse = warehouses.warehouses[selectedWarehouseIndex];
      <div class="tile-list boxes">
        @for (box of warehouse.rooms[selectedRoomIndex].boxes; track $index) {
          <div class="tile">
            <mat-card class="tile-card" (click)="enterBox($index)">
              <mat-card-title>{{ box.name }}</mat-card-title>
              <mat-card-subtitle>{{ box.description }}</mat-card-subtitle>
            </mat-card>
          </div>
        }
      </div>
    }

    <!-- Items -->
    @if (viewLevel === 3
    && selectedWarehouseIndex !== null
    && selectedRoomIndex !== null
    && selectedBoxIndex !== null) {
      @let warehouse = warehouses.warehouses[selectedWarehouseIndex];
      <mat-list>
        @for (item of warehouse.rooms[selectedRoomIndex].boxes[selectedBoxIndex].items; track $index) {
          <mat-list-item>
            <mat-icon matListIcon>inventory_2</mat-icon>
            <div matLine>{{ item.name }}</div>
            <div matLine class="secondary">{{ item.description }}</div>
          </mat-list-item>
        }
      </mat-list>
    }
  }
</mat-card>
