@let warehouse = (warehouse$ | async);

@if (warehouse) {
  <mat-card class="warehouse-card">

    <!-- Back arrow -->
    @if (viewLevel > 0) {
      <div class="nav-header">
        <button mat-icon-button (click)="goBack()">
          <mat-icon>arrow_back</mat-icon>
        </button>
        <span class="nav-title">
          {{ getNavTitle(warehouse) }}
        </span>
      </div>
    }

    <!-- ROOMS -->
    @if (viewLevel === 0) {
      <mat-card-title>{{ warehouse.name }}</mat-card-title>
      <mat-card-subtitle>{{ warehouse.description }}</mat-card-subtitle>
      <button mat-raised-button color="primary" (click)="addRoom()">
        <mat-icon>add</mat-icon> Add Room
      </button>

      <mat-grid-list cols="3" rowHeight="150px" gutterSize="16px">
        @for (room of warehouse.rooms; track $index) {
          <mat-grid-tile>
            <mat-card class="room-card" (click)="enterRoom($index)">
              <mat-card-title>{{ room.name }}</mat-card-title>
              <mat-card-subtitle>{{ room.description }}</mat-card-subtitle>
            </mat-card>
          </mat-grid-tile>
        }
      </mat-grid-list>
    }

    <!-- BOXES -->
    @if (viewLevel === 1 && selectedRoomIndex !== null) {
      <button mat-stroked-button color="accent" (click)="addBox(selectedRoomIndex)">
        <mat-icon>add</mat-icon> Add Box
      </button>

      <mat-grid-list cols="3" rowHeight="120px" gutterSize="12px">
        @for (box of warehouse.rooms[selectedRoomIndex].boxes; track $index) {
          <mat-grid-tile>
            <mat-card class="box-card" (click)="enterBox($index)">
              <mat-card-title>{{ box.name }}</mat-card-title>
              <mat-card-subtitle>{{ box.description }}</mat-card-subtitle>
            </mat-card>
          </mat-grid-tile>
        }
      </mat-grid-list>
    }

    <!-- ITEMS -->
    @if (viewLevel === 2 && selectedRoomIndex !== null && selectedBoxIndex !== null) {
      <button mat-flat-button color="warn" (click)="addItem(selectedRoomIndex, selectedBoxIndex)">
        <mat-icon>add</mat-icon> Add Item
      </button>

      <mat-list>
        @for (item of warehouse.rooms[selectedRoomIndex].boxes[selectedBoxIndex].items; track $index) {
          <mat-list-item>
            <mat-icon matListIcon>inventory_2</mat-icon>
            <div matLine>{{ item.name }}</div>
            <div matLine class="secondary">{{ item.description }}</div>
          </mat-list-item>
        }
      </mat-list>
    }
  </mat-card>
} @else {
  <mat-card>
    <mat-card-content>No warehouse created yet.</mat-card-content>
  </mat-card>
}
